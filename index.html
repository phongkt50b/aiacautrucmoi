<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Công Cụ Minh Họa Phí Bảo Hiểm</title>
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <link href="style.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet"/>

  <!-- IMAGE GALLERY MODULE CSS -->
  <style id="image-gallery-module-styles">
    .img-company-gallery{
      margin:24px 0 32px;
      padding:16px 12px 4px;
      border:1px solid #e5e7eb;
      border-radius:12px;
      background:#fff;
    }
    .img-company-gallery h3{
      margin:0 0 14px;
      font-size:18px;
      font-weight:600;
    }
    .img-company-grid{
      display:grid;
      gap:14px;
      grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
    }
    .img-product-gallery{
      margin:40px 0 60px;
      padding:20px 16px 8px;
      border:1px solid #e5e7eb;
      border-radius:14px;
      background:#fff;
    }
    .img-product-gallery h3{
      margin:0 0 18px;
      font-size:20px;
      font-weight:700;
    }
    .img-product-block{ margin-bottom:36px; }
    .img-product-title{
      font-size:16px;
      font-weight:600;
      margin:0 0 8px;
      color:#333;
    }
    .img-grid{
      display:grid;
      gap:14px;
      grid-template-columns:repeat(auto-fill,minmax(190px,1fr));
    }
    .img-figure{
      margin:0;
      padding:10px;
      background:#fafafa;
      border:1px solid #ececec;
      border-radius:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
      position:relative;
      cursor:zoom-in;
      transition:box-shadow .2s;
    }
    .img-figure:hover{ box-shadow:0 2px 6px rgba(0,0,0,.12); }
    .img-thumb{
      width:100%;
      background:#fff;
      border-radius:6px;
      object-fit:contain;
      max-height:250px;
      transition:transform .2s ease, opacity .2s;
    }
    .img-thumb.loading{ opacity:0.3; }
    .img-caption{
      font-size:12px;
      line-height:1.35;
      text-align:center;
      color:#444;
      min-height:28px;
      overflow-wrap:break-word;
    }
    .orientation-portrait .img-thumb{ max-height:320px; }
    .orientation-landscape .img-thumb{ max-height:210px; }
    .img-thumb-error{
      opacity:.5;
      filter:grayscale(1);
      outline:2px dashed #d33;
    }
    .img-lightbox{
      position:fixed;
      inset:0;
      z-index:9999;
      display:none;
      font-family:inherit;
    }
    .img-lightbox.show{ display:block; }
    .img-lightbox-backdrop{
      position:absolute;
      inset:0;
      background:rgba(0,0,0,0.75);
      backdrop-filter:blur(2px);
    }
    .img-lightbox-dialog{
      position:absolute;
      top:50%;left:50%;
      transform:translate(-50%,-50%);
      max-width:92vw;
      max-height:90vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
      color:#fff;
    }
    .img-lightbox-dialog img{
      max-width:92vw;
      max-height:70vh;
      object-fit:contain;
      background:#111;
      border-radius:10px;
      box-shadow:0 0 0 1px #444;
    }
    .img-lightbox-caption{
      font-size:14px;
      max-width:80ch;
      text-align:center;
      line-height:1.35;
    }
    .img-lightbox-close{
      position:absolute;
      top:-44px;
      right:-8px;
      background:transparent;
      color:#fff;
      font-size:42px;
      border:none;
      cursor:pointer;
      line-height:1;
    }
    .img-lightbox-nav{
      display:flex;
      gap:16px;
    }
    .img-lightbox-nav button{
      background:#fff;
      color:#000;
      border:none;
      padding:8px 16px;
      font-size:14px;
      font-weight:600;
      border-radius:24px;
      cursor:pointer;
    }
    .img-lightbox-nav button:disabled{
      opacity:.35;
      cursor:default;
    }
     /* Custom styles for the viewer modal */
    #viewer-modal.loading #viewer-iframe {
        opacity: 0.3;
    }
    #viewer-modal.visible {
      opacity: 1;
      pointer-events: auto;
    }
  </style>
<script type="module" src="data.js"></script>
<script type="module" src="logic.js"></script>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.27.0",
    "marked": "https://aistudiocdn.com/marked@^16.4.1"
  }
}
</script>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
  <div class="container mx-auto p-4 sm:p-6 lg:p-8">
    <header class="pb-6 border-b-2 border-red-600 mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Công Cụ Minh Họa Phí Bảo Hiểm</h1>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 space-y-6">

        <div id="main-person-container" class="person-container space-y-6 bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">1. Thông Tin Người Được Bảo Hiểm Chính</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-medium block mb-1">Họ và Tên</label>
              <input type="text" class="form-input name-input" placeholder="Nguyễn Văn A">
            </div>
            <div>
              <label class="font-medium block mb-1">Ngày sinh</label>
              <input type="text" class="form-input dob-input" placeholder="DD/MM/YYYY">
            </div>
            <div>
              <label class="font-medium block mb-1">Giới tính</label>
              <select class="form-select gender-select">
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
              </select>
            </div>
            <div class="flex items-end">
              <p class="text-lg">Tuổi: <span class="font-bold text-aia-red age-span">0</span></p>
            </div>
            <div class="relative">
              <label class="font-medium block mb-1">Nghề nghiệp</label>
              <input type="text" class="form-input occupation-input" placeholder="Gõ để tìm nghề nghiệp...">
              <div class="occupation-autocomplete hidden absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto"></div>
            </div>
            <div class="flex items-end">
              <p class="text-lg">Nhóm nghề: <span class="font-bold text-aia-red risk-group-span">...</span></p>
            </div>
          </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">2. Lựa Chọn Sản Phẩm Chính</h2>
          <div>
            <select id="main-product" class="form-select">
              <option value="">-- Chọn sản phẩm chính --</option>
              <!-- Options are populated by logic.js -->
            </select>
            <div id="main-product-fee-display" class="mt-2 text-sm text-aia-red font-semibold"></div>
          </div>
          <div id="main-product-options" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
            <!-- Dynamic options for the selected product will be injected here -->
          </div>
        </div>

        <div id="main-supp-container" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h2 class="text-xl font-bold text-aia-red mb-4">3. Sản Phẩm Bổ Sung (cho NĐBH chính)</h2>
            <div class="supplementary-products-container space-y-4">
                <!-- Rider HTML templates will be injected here by JS -->
            </div>
        </div>

        <div id="supplementary-insured-section">
            <div id="supplementary-insured-container" class="space-y-6">
                <!-- Supplementary person blocks will be added here by JS -->
            </div>
            <div class="mt-6">
                <button id="add-supp-insured-btn" class="w-full bg-aia-red text-white font-semibold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">
                    + Thêm Người Được Bảo Hiểm Bổ Sung
                </button>
            </div>
        </div>
        
        <div id="mdp3-section" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h2 class="text-xl font-bold text-aia-red mb-4">Miễn đóng phí 3.0</h2>
            <div id="mdp3-radio-list"></div>
        </div>

      </div>

      <div id="results-container" class="lg:col-span-1 space-y-6">
        <div class="sticky top-8 space-y-6">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h2 class="text-xl font-bold text-aia-red mb-4">Tóm Tắt Phí Bảo Hiểm (Năm)</h2>
                <div id="global-error-box" class="mb-4"></div>
                <div class="space-y-3">
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-medium">Phí SP chính:</span>
                        <span id="main-insured-main-fee" class="font-bold">0</span>
                    </div>
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-medium">Phí đóng thêm:</span>
                        <span id="main-insured-extra-fee" class="font-bold">0</span>
                    </div>
                    <div class="flex justify-between items-center text-lg">
                        <span class="font-medium">Tổng phí SP bổ sung:</span>
                        <span id="summary-supp-fee" class="font-bold">0</span>
                    </div>
                     <div class="flex justify-between items-center text-lg mt-2">
                        <button id="toggle-supp-list-btn" class="text-sm text-blue-600 hover:underline">Chi tiết</button>
                    </div>
                    <div id="supp-insured-summaries" class="hidden pl-4 border-l-2 text-sm text-gray-600 space-y-1"></div>
                    <hr class="my-3"/>
                    <div class="flex justify-between items-center text-2xl font-bold text-aia-red pt-2">
                        <span>TỔNG PHÍ NĂM:</span>
                        <span id="summary-total">0</span>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h2 class="text-xl font-bold text-aia-red mb-4">Tùy Chọn Đóng Phí</h2>
                <div class="space-y-4">
                    <div>
                        <label for="payment-frequency" class="font-medium block mb-1">Định kỳ đóng phí</hlabel>
                        <select id="payment-frequency" class="form-select">
                            <option value="year">Năm</option>
                            <option value="half">Nửa năm</option>
                            <option value="quarter">Quý</option>
                        </select>
                    </div>
                    <div id="frequency-breakdown" class="hidden text-sm space-y-2 border-t pt-3">
                        <p class="font-semibold text-base">Phí theo định kỳ:</p>
                        <div class="flex justify-between"><span>Phí SP chính:</span> <span id="freq-main">0</span></div>
                        <div class="flex justify-between"><span>Phí đóng thêm:</span> <span id="freq-extra">0</span></div>
                        <div class="flex justify-between"><span>Phí SP bổ sung (ước tính):</span> <span id="freq-supp-total">0</span></div>
                        <div class="flex justify-between font-bold text-base border-t pt-1"><span>Tổng phí/kỳ:</span> <span id="freq-total-period">0</span></div>
                        <p class="text-xs text-gray-500 pt-2">Tổng phí quy năm: <span id="freq-total-year-equivalent"></span> (so với phí năm gốc <span id="freq-total-year"></span>, chênh lệch <span id="freq-diff"></span>)</p>
                    </div>
                </div>
            </div>
             <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h2 class="text-xl font-bold text-aia-red mb-4">Tùy Chọn Minh Họa</h2>
                <div>
                  <label for="target-age-input" class="font-medium text-gray-700 block mb-1">Minh họa phí đến năm (tuổi NĐBH chính)</label>
                  <input type="number" id="target-age-input" class="form-input" value="99" min="1" max="99">
                  <p id="target-age-hint" class="text-xs text-gray-500 mt-1"></p>
                </div>
                <div class="mt-4">
                    <label for="custom-interest-rate-input" class="font-medium text-gray-700 block mb-1">Lãi suất minh họa (%)</label>
                    <input type="number" id="custom-interest-rate-input" class="form-input" value="5" min="0" max="10" step="0.5">
                </div>
            </div>

            <button id="btnFullViewer" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors text-lg">
                Xem Bảng Minh Họa Chi Tiết
            </button>
        </div>
      </div>
    </main>
  </div>
  
  <div id="summary-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full justify-center items-center" style="z-index: 100;">
      <div class="relative mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white">
          <div class="mt-3">
              <div id="summary-content-container" class="prose max-w-none">
                  <!-- Summary content will be injected here -->
              </div>
              <div class="items-center px-4 py-3">
                  <button id="close-summary-modal-btn" class="px-4 py-2 bg-gray-500 text-white text-base font-medium rounded-md w-full shadow-sm hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-gray-300">
                      Đóng
                  </button>
              </div>
          </div>
      </div>
  </div>

    <div id="viewer-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 p-0 opacity-0 pointer-events-none transition-opacity duration-300 z-[1000]">
        <div class="bg-white rounded-lg shadow-xl w-11/12 h-5/6 max-w-6xl flex flex-col relative">
            <button id="close-viewer-modal-btn" class="absolute top-2 right-2 text-gray-600 hover:text-gray-900 text-3xl font-bold z-10 transform-gpu">&times;</button>
            <iframe id="viewer-iframe" class="w-full h-full rounded-lg border-0" src="about:blank"></iframe>
        </div>
    </div>
</body>
</html>
