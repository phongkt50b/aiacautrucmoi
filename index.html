
<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>Công Cụ Minh Họa Phí Bảo Hiểm</title>
  <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
  <link href="style.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com" rel="preconnect"/>
  <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700&display=swap" rel="stylesheet"/>
</head>
<body class="bg-gray-50 font-sans text-gray-800">
  <div class="container mx-auto p-4 sm:p-6 lg:p-8">
    <header class="pb-6 border-b-2 border-red-600 mb-6">
      <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Công Cụ Minh Họa Phí Bảo Hiểm</h1>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <div class="lg:col-span-2 space-y-6">

        <div id="main-person-container" class="person-container space-y-6 bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">1. Thông Tin Người Được Bảo Hiểm Chính</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="font-medium block mb-1">Họ và Tên</label>
              <input type="text" class="form-input name-input" placeholder="Nguyễn Văn A">
            </div>
            <div>
              <label class="font-medium block mb-1">Ngày sinh</label>
              <input type="text" class="form-input dob-input" placeholder="DD/MM/YYYY">
            </div>
            <div>
              <label class="font-medium block mb-1">Giới tính</label>
              <select class="form-select gender-select">
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
              </select>
            </div>
            <div class="flex items-end">
              <p class="text-lg">Tuổi: <span class="font-bold text-aia-red age-span">0</span></p>
            </div>
            <div class="relative">
              <label class="font-medium block mb-1">Nghề nghiệp</label>
              <input type="text" class="form-input occupation-input" placeholder="Gõ để tìm nghề nghiệp...">
              <div class="occupation-autocomplete hidden absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto"></div>
            </div>
            <div class="flex items-end">
              <p class="text-lg">Nhóm nghề: <span class="font-bold text-aia-red risk-group-span">...</span></p>
            </div>
          </div>
        </div>

        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">2. Lựa Chọn Sản Phẩm Chính</h2>
          <div>
            <select id="main-product" class="form-select">
              <option value="">-- Chọn sản phẩm chính --</option>
            </select>
          </div>
          <div id="main-product-options" class="mt-4 space-y-4"></div>
          <div id="main-product-fee-display" class="text-right font-bold text-lg text-aia-red mt-2 min-h-[1.75rem]"></div>
        </div>

          <div id="main-supp-container" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">3. Lựa Chọn Sản Phẩm Bổ Sung (Cho NĐBH Chính)</h2>
          <div class="supplementary-products-container space-y-6"></div>
        </div>

        <div id="supplementary-insured-section" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
          <h2 class="text-xl font-bold text-aia-red mb-4">4. Người Được Bảo Hiểm Bổ Sung</h2>
          <div id="supplementary-insured-container" class="space-y-6"></div>
          <button id="add-supp-insured-btn" class="mt-4 px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors w-full text-left flex items-center space-x-2">
            <span>+ Thêm Người Được Bảo Hiểm Bổ Sung</span>
          </button>
        </div>

        <div id="waiver-of-premium-section" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
           <h2 class="text-xl font-bold text-aia-red mb-4">5. Miễn Đóng Phí (Bên mua bảo hiểm)</h2>
           <div id="waiver-of-premium-container" class="space-y-4"></div>
        </div>
      </div>

      <div class="lg:col-span-1">
        <div id="results-container" class="bg-white p-5 rounded-xl shadow-sm border-2 border-aia-red sticky top-8 space-y-3">

          <div class="flex items-center justify-between">
            <h2 class="text-base font-semibold text-gray-700">Tổng phí (năm)</h2>
          </div>
          <div class="text-2xl font-extrabold text-aia-red tracking-tight">
            <span id="summary-total">0</span>
          </div>

          <div class="border-t pt-3">
            <ul class="text-base space-y-1">
              <li class="flex justify-between">
                <span>Phí sản phẩm chính</span><span id="main-insured-main-fee">0</span>
              </li>
              <li class="flex justify-between">
                <span>Phí đóng thêm</span><span id="main-insured-extra-fee">0</span>
              </li>
              <li class="flex justify-between">
                <span>Phí sản phẩm bổ sung</span><span id="summary-supp-fee">0</span>
              </li>
            </ul>
          </div>

          <div class="border-t pt-3">
            <div id="supp-insured-summary-line" class="flex justify-between text-base mt-1">
              <button id="toggle-supp-list-btn" class="text-base text-aia-red underline">Xem từng người</button>
            </div>
            <div id="supp-insured-summaries" class="mt-2 hidden text-base space-y-1"></div>
          </div>
        
          <div>
            <label for="payment-frequency" class="font-medium text-gray-700 block mb-1">Kỳ đóng phí</label>
            <select id="payment-frequency" class="form-select w-full" aria-label="Kỳ đóng phí">
              <option value="year" selected>Năm (mặc định)</option>
              <option value="half">Nửa năm</option>
              <option value="quarter">Quý</option>
            </select>
          </div>

          <div id="frequency-breakdown" class="space-y-1 text-gray-700 hidden text-base">
            <div class="flex justify-between">
              <span>Phí chính:</span><span id="freq-main">0</span>
            </div>
            <div class="flex justify-between">
              <span>Phí đóng thêm:</span><span id="freq-extra">0</span>
            </div>
            <div class="flex justify-between">
              <span>Phí sản phẩm bổ sung:</span><span id="freq-supp-total">0</span>
            </div>
            <div class="flex justify-between font-semibold">
              <span>Tổng:</span><span id="freq-total-period" class="text-aia-red">0</span>
            </div>
            <div class="flex justify-between">
              <span>Tổng quy năm:</span><span id="freq-total-year-equivalent">0</span>
            </div>
            <div class="flex justify-between">
              <span>Tổng năm:</span><span id="freq-total-year">0</span>
            </div>
            <div class="flex justify-between">
              <span>Chênh lệch:</span><span id="freq-diff" class="text-red-600 font-bold">0</span>
            </div>
          </div>

          <div class="border-t pt-3 space-y-2" id="target-age-block">
            <div>
              <label for="target-age-input" id="target-age-label" class="font-medium text-gray-700 block mb-1">
                Minh họa phí đến năm (tuổi NĐBH chính)
              </label>
              <input type="number" id="target-age-input" class="form-input" placeholder="VD: 75" min="0" max="100">
              <p id="target-age-hint" class="text-sm text-gray-500 mt-1"></p>
              <p id="target-age-error" class="text-sm text-red-600 mt-1 hidden"></p>
            </div>
            <div>
              <label for="custom-interest-rate-input" class="font-medium text-gray-700 block mb-1">
                Lãi suất minh họa (%)
              </label>
              <input type="number" id="custom-interest-rate-input" class="form-input" placeholder="VD: 4.7" value="4.7">
            </div>
            <div id="global-error-box" class="hidden" aria-live="assertive"></div>

            <button id="btnFullViewer" class="w-full bg-aia-red text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">Xem Bảng Minh Họa Chi Tiết</button>
            <div id="error-message" class="text-center text-red-500 font-medium min-h-[1.25rem]" aria-live="assertive"></div>
          </div>
        </div>
      </div>
    </main>

    <footer class="text-center text-gray-500 mt-12 py-4 border-t">
      Công cụ này chỉ mang tính tham khảo cá nhân, không phải bảng minh họa chính thức của AIA. 
      Quyền lợi và phí thực tế sẽ theo hợp đồng do AIA phát hành. 
      Với mỗi hợp đồng phát hành thành công có sự giúp sức của công cụ này, em Phong sẽ rất vui khi được anh/chị mời một ly cà phê qua MB Bank – Nguyễn Thanh Phong, STK: 096.714.0556. 
      Trân trọng biết ơn anh/chị!
    </footer>
  </div>

  <template id="supplementary-person-template">
    <div class="person-container space-y-6 bg-gray-100 p-4 rounded-lg mt-4">
      <button class="w-full text-right text-sm text-red-600 font-semibold remove-supp-btn">Xóa NĐBH này</button>
      <h3 class="text-lg font-bold text-gray-700 mb-2 border-t pt-4" data-template-id="title">NĐBH Bổ Sung</h3>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <label class="font-medium text-gray-700 block mb-1" data-template-id="name-label">Họ và Tên</label>
          <input type="text" class="form-input name-input" placeholder="Trần Thị B" data-template-id="name">
        </div>
          <div>
          <label class="font-medium text-gray-700 block mb-1" data-template-id="dob-label">Ngày sinh</label>
          <input type="text" class="form-input dob-input" placeholder="DD/MM/YYYY" data-template-id="dob">
        </div>
        <div>
          <label class="font-medium text-gray-700 block mb-1" data-template-id="gender-label">Giới tính</label>
          <select class="form-select gender-select" data-template-id="gender">
            <option value="Nam">Nam</option>
            <option value="Nữ">Nữ</option>
          </select>
        </div>
        <div class="flex items-end space-x-4">
          <p class="text-lg">Tuổi: <span class="font-bold text-aia-red age-span" data-template-id="age-span">0</span></p>
        </div>
        <div class="relative">
          <label class="font-medium text-gray-700 block mb-1" data-template-id="occupation-label">Nghề nghiệp</label>
          <input type="text" class="form-input occupation-input" placeholder="Gõ để tìm nghề nghiệp..." data-template-id="occupation-input">
          <div class="occupation-autocomplete hidden absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-y-auto"></div>
        </div>
        <div class="flex items-end space-x-4">
          <p class="text-lg">Nhóm nghề: <span class="font-bold text-aia-red risk-group-span" data-template-id="risk-group-span">...</span></p>
        </div>
      </div>
      <div class="mt-4">
        <h4 class="text-md font-semibold text-gray-800 mb-2">Sản phẩm bổ sung cho người này</h4>
        <div class="supplementary-products-container space-y-6"></div>
      </div>
    </div>
  </template>

  <script>
    window.addEventListener('error', e => {
      const box = document.getElementById('error-message') || document.body.appendChild(Object.assign(document.createElement('div'), {id:'error-message'}));
      box.style.cssText = 'position:fixed;left:8px;bottom:8px;background:#fee;color:#b00;padding:8px 12px;border:1px solid #f99;border-radius:6px;z-index:99999';
      box.textContent = (e.message||'JS error') + ' @ ' + (e.filename||'') + ':' + (e.lineno||'');
    });
  </script>
  <script type="module" src="logic.js"></script>

<!-- VIEWER MODAL -->
<div id="viewer-modal" class="modal-container fixed inset-0 bg-black bg-opacity-75 p-0 opacity-0 pointer-events-none transition-opacity duration-300 z-[100]">
  <div class="bg-white w-full h-full shadow-xl flex flex-col relative">
    <button id="close-viewer-modal-btn" class="absolute top-2 right-2 text-3xl font-light leading-none hover:text-red-600 text-black bg-white/70 rounded-full w-10 h-10 flex items-center justify-center z-10" aria-label="Đóng viewer">&times;</button>
    <iframe id="viewer-iframe" src="about:blank" class="w-full h-full border-0" title="Bảng minh họa chi tiết"></iframe>
  </div>
</div>
</body>
</html>
